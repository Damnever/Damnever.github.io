<!DOCTYPE html>
<!-- Refer to: http://www.imooc.com/learn/114 -->
<html>
    <head>
        <meta charset="utf-8">
        <title>人在Qi途</title>
        <meta name="keywords" content="Damnever,X.C.Dong,人在Qi途,about,关于,Python,Android,Web,时间轴,误入奇途"/>
<meta name="description" content="Damnever,X.C.Dong,about,人在Qi途,关于,Python 框架,Android,Web,时间轴,误入奇途" />

        <link rel="stylesheet" type="text/css" href="./css/style.css"/>
        <link rel="shortcut" href="./imgs/Damnever.png" />
        <link rel="shortcut icon" href="./imgs/Damnever.png"/>
        <script type="text/javascript" src="./js/contact.js"></script>
    </head>
    <body>
    
    <div class="hide">
        <div id="tpl_scrubber_year">
            <a href="javascript:;" class="scrubber_year current" id="scrubber_year_{year}" onclick="show_year({year})">{year}</a>
            {list}
        </div>
        <div id="tpl_scrubber_month">
            <a href="javascript:;" class="scrubber_month scrubber_month_in_{year}" id="scrubber_month_{year}_{month}" onclick="show_month({year},{month})">{month}月</a>
        </div>

        <div id="tpl_content_year">
            <div class="content_year" id="content_year_{year}">{year}</div>
            {list}
        </div>
        <div id="tpl_content_month">
            <div class="content_month" id="content_month_{year}_{month}">{month}月</div>
            {list}
        </div>

        <div id="tpl_content_item">
        <div class="content_item">
            <div class="content_item_icon_arrow"></div>
                <div class="content_item_icon_dot">
                    <div class="content_item_icon_dot_child"></div>
                </div>
                <div class="content_item_head">
                    <div class="content_item_head_title">
                        <div class="content_item_head_title_day">{day}</div>
                        {title}
                    </div>
                <div class="content_item_head_intro">
                    {intro}
                </div>
                </div>
                <div class="content_item_media">
                    
                </div>
            <div class="content_item_footer">{summary}</div>
        </div>
        </div>

    </div>
    
        <div class="header">
        <div class="top">
            <div class="header_left_top">
                <div class="header_pic"><img src="./imgs/Damnever.png" width="100" height="100" /></div>
                <div class="header_name">Damnever<br />X.C.Dong</div>
            </div>
            <div class="header_right_top">
                <div class="header_contact">
                    <div id="notice-tit">
                    <ul>
                        <li class="select">
                            <a href="javascript:;">Google</a>
                        </li>
                        <li>
                            <a href="javascript:;">Github</a>
                        </li>
                        <li>
                            <a href="javascript:;">Weibo</a>
                        </li>
                        <li>
                            <a href="javascript:;">Twitter</a>
                        </li>
                        <li>
                            <a href="javascript:;">E-mail</a>
                        </li>
                    </ul>
                    </div>
                    <div id="notice-con">
                    <div class="mod" style="display:block">
                        <span class="p">dxc.wolf[at]gmail.com</span>
                    </div>
                    <div class="mod" style="display:none">
                        <a href="https://github.com/Damnever" target="_blank">Damnever(X.C.Dong)</a>
                        
                    </div>
                    <div class="mod" style="display:none">
                        <a href="http://weibo.com/u/1977691952?wvr=5&wvr=5&lf=reg" target="_blank">盖山</a>
                    </div>
                    <div class="mod" style="display:none">
                        <a href="https://twitter.com/WolfDxc" target="_blank">道走(@WolfDxc)</a>
                    </div>
                    <div class="mod" style="display:none">
                        <span class="p">dxc_wolf[at]163.com</span>
                    </div>
                </div>
                </div>
            </div>
        </div>   


            <div class="clearfix"></div>
            <div class="header_skills">
                <span class="skill">Linux</span> <span class="level">用户</span>
                <span class="skill">Vim</span> <span class="level"> 小学生</span>
                <span class="skill">Python</span> <span class="level"> 爱好者</span>
                <span class="skill">Android</span> <span class="level"> 路人</span>
                <span class="skill">前端</span> <span class="level"> 白痴</span>
            </div>

        </div>

        <div class="container">

            <div class="scrubber" id="scrubber">
                <a href="" class="scrubber_year current">2014</a>
                <a href="" class="scrubber_month">.</a>
                <a href="" class="scrubber_month">.</a>
            </div>

            <div class="content" id="content">
                <div class="content_year">.</div>
                <div class="content_year">.</div>

                <div class="content_item">
                    <div class="content_item_icon_arrow"></div>
                    <div class="content_item_icon_dot">
                        <div class="content_item_icon_dot_child"></div>
                    </div>
                    <div class="content_item_head">
                        <div class="content_item_head_title">
                            <div class="content_item_head_title_day">..</div>
                            2014-03-30
                        </div>
                        <div class="content_item_head_intro">
                            ...
                        </div>
                    </div>
                    <div class="content_item_footer">...</div>
                </div>

            </div>

        </div>
        <video style="display:none;" controls="" autoplay="autoplay" loop="loop" name="media"><source src="./media/DoMaJe-Way_Down_in the_Hole.mp3" type="audio/mpeg"></video>
        <script type="text/javascript" src="./js/data.js"></script>
        <script type="text/javascript" src="./js/GetLunarDay.js"></script>
        <script type="text/javascript" src="./js/fx.js"></script>
        <script type="text/javascript">
            var g = function(id) {
                return document.getElementById(id);
            }

            var g_class = function(className) {
                return document.getElementsByClassName(className);
            }

            var g_tpl = function(id) {
                return g('tpl_' + id).innerHTML;
            }

            var get_body_width = function() {
                return document.body.offsetWidth;
            }

            var get_body_height = function() {
                return document.body.offsetHeight;
            }
            
            var list = {};
            for (var i=0; i < data.length; i++) {
                var date = new Date(data[i].date);
                var year = date.getFullYear();
                var month = date.getMonth() + 1;
                var day = date.getDate();
                
                //var lunar = GetLunarDateString(date);
                
                if (!list[year]) {
                    list[year] = {};
                }
                if (!list[year][month]) {
                    list[year][month] = [];
                }

                var item = data[i];
                //item.lunar = lunar[0] + "<br/>&nbsp;&nbsp;" + lunar[1];
                item.year = year;
                item.month = month;
                item.day = day;

                list[year][month].push(item);
                
            }
 

            // Date list
                var html_scrubber_list = [];
                var tpl_year = g_tpl('scrubber_year');
                var tpl_month = g_tpl('scrubber_month');

                for (y in list) {
                    var html_year = tpl_year.replace(/\{year\}/g, y);

                    var html_month = [];
                    for (m in list[y]) {
                        html_month.unshift(tpl_month.replace(/\{month\}/g, m).replace(/\{year\}/g, y));
                    }

                    html_year = html_year.replace(/\{list\}/g, html_month.join('')); 

                    html_scrubber_list.unshift(html_year);
                }

                g("scrubber").innerHTML = '<a href="javascript:;"  class="scrubber_year current" id="scrubber_year_1994" onclick="scroll_top(0)">现在</a>'
                    + html_scrubber_list.join('') 
                    + '<a href="javascript:;"  class="scrubber_year current" id="scrubber_year_1994" onclick="scroll_top(get_body_height())">出生</a>';



                // Content list
                var html_content_list = [];
                var tpl_year = g_tpl('content_year');
                var tpl_month = g_tpl('content_month');
                var tpl_item = g_tpl('content_item');

                for (y in list) {
                    var html_year = tpl_year.replace(/\{year\}/g, y);

                    var html_month = [];
                    for (m in list[y]) {

                        var html_item = [];
                        for (i in list[y][m]) {
                            var item_data = list[y][m][i];

                            var item_html = tpl_item
                                    .replace(/\{title\}/g, item_data.title)
                                    .replace(/\{day\}/g, item_data.day)
                                    .replace(/\{intro\}/g, item_data.intro)
                                    .replace(/\{summary\}/g, item_data.summary);
                            html_item.push(item_html);
                        }

                        html_month.unshift(tpl_month.replace(/\{month\}/g, m).replace(/\{year\}/g, y).replace(/\{list\}/g, html_item.join('')));
                    }

                    html_year = html_year.replace(/\{list\}/g, html_month.join('')); 

                    html_content_list.unshift(html_year);
                }
                g("content").innerHTML = html_content_list.join('') + '<div class="content_year" id="content_year_1994">出生</div>';

                // Gets element's height.
                var get_top = function(element) {
                    return element.offsetTop + 170;
                }
                // Scroll distance from top
                var scroll_top = function(to) {
                    var start = document.body.scrollTop;
                    fx(function(now){
                        window.scroll(0, now);
                    }, start, to);

                }

                // Year, month clicked.
                var show_year = function(year) {
                    //console.log(year);
                    var c_year = g('content_year_' + year);
                    var top = get_top(c_year);
                    scroll_top(top);
                    expand_year(year, g('scrubber_year_'+year));
                }   

                var show_month = function(year, month) {
                    //console.log(year, month);
                    var c_month = g('content_month_' + year + '_' + month);
                    var top = get_top(c_month);
                    scroll_top(top);
                    highlight_month(g('scrubber_month_' + year + '_' + month));
                }

                // Highlights current date.
                var highlight_month = function( element ) {
                    var months = g_class('scrubber_month');
                    for (var i=months.length-1; i >= 0; i--) {
                        months[i].className = months[i].className.replace(/current/g, '');
                    }
                    element.className = element.className + ' current';
                    //console.log(element.className);
                }

                // Spreads and shrinks months of year.
                var expand_year = function(year, element) {
                    var months = g_class('scrubber_month');
                    var show_month = g_class('scrubber_month_in_'+year);
                    var years = g_class('scrubber_year');
                    for (var i=months.length-1; i >= 0; i--) {
                        months[i].style.display = "none";
                    }
                    for (var i=show_month.length-1; i >= 0; i--) {
                        show_month[i].style.display = "block";
                    }
                    for (var i=years.length-1; i >= 0; i--) {
                        years[i].className = years[i].className.replace(/\s?current\s?/g, '');
                    }
                    element.className = element.className + ' current';
                }

                var update_scrubber_year = function(top) {
                    var c_years = g('content').getElementsByClassName('content_year');
                    var tops = [];
                    for (var i=0; i < c_years.length; i++) {
                        tops.push(c_years[i].offsetTop);
                    }
                    for (var i=1; i < tops.length; i++) {
                        if(top > tops[i-1] && top < tops[i]) {
                            var year = c_years[i-1].innerHTML;
                            var s_year = g('scrubber_year_'+year);
                            expand_year(year, s_year);
                        }
                    }

                }

                var update_scrubber_month = function(top) {
                    var c_months = g('content').getElementsByClassName('content_month');
                    var tops = [];
                    for (var i=0; i < c_months.length; i++) {
                        tops.push(c_months[i].offsetTop);
                    }
                     for (var i=1; i < tops.length; i++) {
                        if(top > tops[i-1] && top < tops[i]) {
                            var id = c_months[i-1].id;
                            highlight_month(g(id.replace('content', 'scrubber')));
                        }
                    }
                }

                // Fixed date line.
                window.onscroll = function() {
                    var top = 0;
                    if (document.body.scrollTop == 0) { // Firefox
                        top = document.documentElement.scrollTop;
                    }
                    if (document.documentElement.scrollTop == 0) { // Chrome
                        top = document.body.scrollTop;
                    }
                    var scrubber = g('scrubber');
                    if(top > 200) {
                        scrubber.style.position = 'fixed';
                        scrubber.style.top = '100px';
                        scrubber.style.left = (get_body_width() - 960) / 2 + 50 + 'px';
                    } else {
                        scrubber.style.position = '';
                        scrubber.style.top = '';
                        scrubber.style.left = '';
                    }

                    update_scrubber_year( top );
                    update_scrubber_month( top );

                }
                
        </script>
    </body>
</html>
